# 后端服务映射

快应用开发阶段，通过修改映射（保存到 localStorage 下 dev.service），可以促使 `H.service` 的请求直接发送到指定地址。

## 关于 CORS
> 配置映射后，会出现跨源资源共享（CORS）问题，可以通过以下方法修正

由于浏览器的安全策略，映射后的请求后报错（CORS、Preflight 预检异常），此时可以通过以下方式解决：

### 1、修改后端服务代码
> 此方法适用于修改代码成本较低的场景

1. 运行 CORS，给响应头增加以下内容：
```shell
Access-Control-Allow-Origin: "请求的 ORIGIN 值"
Access-Control-Allow-Credentials: true
Access-Control-Allow-Headers: *
Access-Control-Allow-Methods: *
```
2. 运行 method=OPTIONS 的请求

### 基于 Spring Boot 的配置方式
> TODO

#### 基于 Fastify 框架的配置方式

```javascript
const app = require('fastify')()

app.addHook('preHandler', (req, res, done)=>{
    // 开启 CORS
    res.header("Access-Control-Allow-Origin", req.headers.origin)
    res.header("Access-Control-Allow-Credentials", 'true')
    res.header("Access-Control-Allow-Headers", "*")
    res.header("Access-Control-Allow-Methods", "*")
    done()
})

// 允许所有 OPTIONS 类型的请求（通常是浏览器的预检策略）
app.options("/*", (req, res)=> res.send())
```

### 2、关闭浏览器的安全策略
> 此处以谷歌浏览器为例

修改谷歌快捷方式，增加启动参数`--disable-web-security`即可，建议单独配置一个关闭安全策略的浏览器。
